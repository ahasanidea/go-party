{"version":3,"sources":["../../src/models/user.js"],"names":["module","exports","sequelize","DataTypes","User","define","username","type","STRING","allowNull","unique","validate","notEmpty","msg","len","args","isUnique","value","findOne","where","user","Error","email","isEmail","password","bio","TEXT","dob","DATE","avatar","is_active","BOOLEAN","defaultValue","associate","Party","belongsToMany","as","through","foreignKey","beforeCreate","bcrypt","hash","beforeUpdate","dataValues"],"mappings":"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","sourcesContent":["/* eslint-disable no-undef */\nimport bcrypt from 'bcrypt'\n\nmodule.exports = (sequelize, DataTypes) => {\n    const User = sequelize.define(\n        'User',\n        {\n            username: {\n                type: DataTypes.STRING,\n                allowNull: false,\n                unique: true,\n                validate: {\n                    notEmpty: {\n                        msg: 'Username is required.',\n                    },\n                    len: {\n                        args: [3, 15],\n                        msg: 'Username length should be between 3 and 15 characters.',\n                    },\n                    async isUnique(value) {\n                        const user = await User.findOne({ where: { username: value } })\n                        if (user) {\n                            throw new Error('A user with that username already exists.')\n                        }\n                    },\n                },\n            },\n            email: {\n                type: DataTypes.STRING,\n                allowNull: false,\n                unique: true,\n                validate: {\n                    isEmail: {\n                        msg: 'Invalid email. Provide a correct email.',\n                    },\n                    async isUnique(value) {\n                        const user = await User.findOne({ where: { email: value } })\n                        if (user) {\n                            throw new Error('A user with that email already exists.')\n                        }\n                    },\n                },\n            },\n            password: {\n                type: DataTypes.STRING,\n                allowNull: false,\n                validate: {\n                    len: {\n                        args: [6, 100],\n                        msg: 'Password should be more than 5 characters.',\n                    },\n                },\n            },\n            bio: {\n                type: DataTypes.TEXT,\n                validate: {\n                    len: {\n                        args: [10, 500],\n                        msg: 'Bio should be more than 10 characters and less than 500 characters',\n                    },\n                },\n            },\n            dob: {\n                type: DataTypes.DATE,\n            },\n            avatar: {\n                type: DataTypes.STRING,\n            },\n            is_active: {\n                type: DataTypes.BOOLEAN,\n                defaultValue: false,\n            },\n        },\n        {}\n    )\n    User.associate = ({ Party }) => {\n        User.belongsToMany(Party, { as: 'attended_parties', through: 'PartyGuests', foreignKey: 'guest_id' })\n    }\n    User.beforeCreate(async user => {\n        try {\n            user.password = await bcrypt.hash(user.password, 8)\n        } catch (error) {\n            throw new Error('Something went wrong')\n        }\n    })\n\n    User.beforeUpdate(async user => {\n        try {\n            if (user.password) {\n                user.password = await bcrypt.hash(user.dataValues.password, 8)\n            }\n        } catch (error) {\n            throw new Error('Could not update the password')\n        }\n    })\n    return User\n}\n"],"file":"user.js"}