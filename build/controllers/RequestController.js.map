{"version":3,"sources":["../../src/controllers/RequestController.js"],"names":["util","Util","RequestController","req","res","user","party_id","params","PartyService","searchParty","party","setError","send","host_id","id","RequestService","checkRequestExists","request","newRequest","guest_id","sendPartyRequest","sentRequest","setSuccess","message","getPartyRequests","requests","request_id","findPartyRequest","destroy","status","UserService","findUser","guest","modifyPartyRequest","addGuests"],"mappings":"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","sourcesContent":["import Util from '../utils/Utils'\nimport RequestService from '../services/RequestService'\nimport PartyService from '../services/PartyService'\nimport UserService from '../services/UserService'\nconst util = new Util()\n\nclass RequestController {\n    static async sendPartyRequest(req, res) {\n        const user = req.user\n        const party_id = req.params.party_id\n        try {\n            const party = await PartyService.searchParty(party_id)\n            if (!party) {\n                util.setError(404, 'The party you are requesting to attend does not exist.')\n                return util.send(res)\n            }\n            if (party.host_id === user.id) {\n                util.setError(400, 'You cannot request to attend your own party.')\n                return util.send(res)\n            }\n            const request = await RequestService.checkRequestExists(user.id, party.id)\n            if (request) {\n                util.setError(400, 'You have already requested to attend this party.')\n                return util.send(res)\n            }\n            const newRequest = {\n                party_id: party.id,\n                guest_id: user.id,\n            }\n            const sentRequest = await RequestService.sendPartyRequest(newRequest)\n            util.setSuccess(201, 'Request successfully sent', sentRequest)\n            return util.send(res)\n        } catch (error) {\n            util.setError(400, error.message)\n            return util.send(res)\n        }\n    }\n\n    static async getPartyRequests(req, res) {\n        const user = req.user\n        const { party_id } = req.params\n        try {\n            const party = await PartyService.searchParty(party_id)\n            if (!party) {\n                util.setError(404, 'Party does not exist.')\n                return util.send(res)\n            }\n            if (party.host_id !== user.id) {\n                util.setError(400, 'You can only view requests for parties you created.')\n                return util.send(res)\n            }\n            const requests = await RequestService.getPartyRequests(party.id)\n            util.setSuccess(200, 'Party requests', requests)\n            return util.send(res)\n        } catch (error) {\n            util.setError(400, error.message)\n            return util.send(res)\n        }\n    }\n\n    static async withdrawPartyRequest(req, res) {\n        const user = req.user\n        const { request_id } = req.params\n        try {\n            const request = await RequestService.findPartyRequest(request_id)\n            if (!request) {\n                util.setError(404, 'That party request does not exist.')\n                return util.send(res)\n            }\n            if (request.guest_id !== user.id) {\n                util.setError(401, 'You can only withdraw your own requests.')\n                return util.send(res)\n            }\n            await request.destroy()\n            util.setSuccess(200, 'Party request successfully withdrawn')\n            return util.send(res)\n        } catch (error) {\n            util.setError(400, error.message)\n            return util.send(res)\n        }\n    }\n\n    static async modifyPartyRequest(req, res) {\n        const { user, params } = req\n        const { party_id, request_id, status } = params\n\n        try {\n            const party = await PartyService.searchParty(party_id)\n            if (!party) {\n                util.setError(404, 'Party with that request does not exist.')\n                return util.send(res)\n            }\n            if (party.host_id !== user.id) {\n                util.setError(400, 'You cannot alter a request for a party you did not create.')\n                return util.send(res)\n            }\n            const request = await RequestService.findPartyRequest(request_id)\n            if (!request) {\n                util.setError(404, 'The request you are trying to alter does not exist.')\n                return util.send(res)\n            }\n            const guest = await UserService.findUser(request.guest_id)\n            await RequestService.modifyPartyRequest(request.id, status)\n            if (status === 'accepted') {\n                await party.addGuests(guest)\n            }\n            util.setSuccess(200, 'Party request altered.')\n            return util.send(res)\n        } catch (error) {\n            util.setError(400, error.message)\n            return util.send(res)\n        }\n    }\n}\n\nexport default RequestController\n"],"file":"RequestController.js"}